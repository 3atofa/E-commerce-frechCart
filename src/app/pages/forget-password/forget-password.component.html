<div class="bg-gray-50 my-4 border rounded-xl shadow p-4 mt-16 lg:w-1/2 mx-4 lg:mx-auto">
    <!-- Step 1: Send verification code -->
    <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" *ngIf="step === 1">
        <div class="mb-4">
            <label for="email" class="block mb-2 text-sm font-medium text-gray-900">
                {{ 'passwordReset.emailLabel' | translate }}
            </label>
            <input formControlName="email" type="email" id="email"
                class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                [class.border-red-500]="resetForm.get('email')?.invalid && resetForm.get('email')?.touched" />
            <div *ngIf="resetForm.get('email')?.invalid && resetForm.get('email')?.touched" class="text-red-500 text-xs mt-1">
                <div *ngIf="resetForm.get('email')?.errors?.['required']">{{ 'passwordReset.emailRequired' | translate }}</div>
                <div *ngIf="resetForm.get('email')?.errors?.['email']">{{ 'passwordReset.emailInvalid' | translate }}</div>
            </div>
        </div>

        <button type="submit" class="btn-main" [disabled]="resetForm.invalid || isLoading">
            <span *ngIf="!isLoading">{{ 'passwordReset.sendCodeButton' | translate }}</span>
            <span *ngIf="isLoading">{{ 'passwordReset.sendingButton' | translate }}</span>
        </button>
    </form>

    <!-- Step 2: Confirm verification code -->
    <form [formGroup]="codeForm" (ngSubmit)="onVerifyCode()" *ngIf="step === 2">
        <div class="mb-4">
            <label for="code" class="block mb-2 text-sm font-medium text-gray-900">
                {{ 'passwordReset.verificationCode' | translate }}
            </label>
            <input formControlName="code" type="text" id="code"
                class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                [class.border-red-500]="codeForm.get('code')?.invalid && codeForm.get('code')?.touched" />
            <div *ngIf="codeForm.get('code')?.invalid && codeForm.get('code')?.touched" class="text-red-500 text-xs mt-1">
                {{ 'passwordReset.codeRequired' | translate }}
            </div>
        </div>

        <button type="submit" class="btn-main" [disabled]="codeForm.invalid || isLoading">
            <span *ngIf="!isLoading">{{ 'passwordReset.verifyCodeButton' | translate }}</span>
            <span *ngIf="isLoading">{{ 'passwordReset.verifyingButton' | translate }}</span>
        </button>
    </form>

    <!-- Step 3: Reset password -->
    <form [formGroup]="passwordForm" (ngSubmit)="onResetPassword()" *ngIf="step === 3">
        <div class="mb-4">
            <label for="newPassword" class="block mb-2 text-sm font-medium text-gray-900">
                {{ 'passwordReset.newPassword' | translate }}
            </label>
            <input formControlName="newPassword" type="password" id="newPassword"
                class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                [class.border-red-500]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" />
            <div *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" class="text-red-500 text-xs mt-1">
                <div *ngIf="passwordForm.get('newPassword')?.errors?.['required']">{{ 'passwordReset.passwordRequired' | translate }}</div>
                <div *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">{{ 'passwordReset.passwordMinLength' | translate }}</div>
                <div *ngIf="passwordForm.get('newPassword')?.errors?.['pattern']">
                    {{ 'passwordReset.passwordPattern' | translate }}
                </div>
            </div>
        </div>

        <div class="mb-4">
            <label for="confirmPassword" class="block mb-2 text-sm font-medium text-gray-900">
                {{ 'passwordReset.confirmPassword' | translate }}
            </label>
            <input formControlName="confirmPassword" type="password" id="confirmPassword"
                class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                [class.border-red-500]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched" />
            <div *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched" class="text-red-500 text-xs mt-1">
                <div *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">{{ 'passwordReset.confirmRequired' | translate }}</div>
                <div *ngIf="passwordForm.hasError('passwordMismatch')">{{ 'passwordReset.passwordMismatch' | translate }}</div>
            </div>
        </div>

        <button type="submit" class="btn-main" [disabled]="passwordForm.invalid || isLoading">
            <span *ngIf="!isLoading">{{ 'passwordReset.resetButton' | translate }}</span>
            <span *ngIf="isLoading">{{ 'passwordReset.resettingButton' | translate }}</span>
        </button>
    </form>

    <!-- Error message display -->
    <div *ngIf="errorMessage" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
        {{ errorMessage }}
    </div>

    <!-- Success message display -->
    <div *ngIf="successMessage" class="mt-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded">
        {{ successMessage }}
    </div>
</div>