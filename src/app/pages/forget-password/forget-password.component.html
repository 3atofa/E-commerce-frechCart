<div class="bg-gray-50 my-4 border rounded-xl shadow p-4 mt-16 lg:w-1/2 mx-4 lg:mx-auto">
    <!-- Step 1: Send verification code -->
    <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" *ngIf="step === 1">
        <div class="mb-4">
            <label for="email" class="block mb-2 text-sm font-medium text-gray-900">
                {{ 'login.email' | translate }}
            </label>
            <input formControlName="email" type="email" id="email"
                class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                [class.border-red-500]="resetForm.get('email')?.invalid && resetForm.get('email')?.touched" />
            <div *ngIf="resetForm.get('email')?.invalid && resetForm.get('email')?.touched" class="text-red-500 text-xs mt-1">
                <div *ngIf="resetForm.get('email')?.errors?.['required']">Email is required</div>
                <div *ngIf="resetForm.get('email')?.errors?.['email']">Please enter a valid email</div>
            </div>
        </div>

        <button type="submit" class="btn-main" [disabled]="resetForm.invalid || isLoading">
            <span *ngIf="!isLoading">Send Verification Code</span>
            <span *ngIf="isLoading">Sending...</span>
        </button>
    </form>

    <!-- Step 2: Confirm verification code -->
    <form [formGroup]="codeForm" (ngSubmit)="onVerifyCode()" *ngIf="step === 2">
        <div class="mb-4">
            <label for="code" class="block mb-2 text-sm font-medium text-gray-900">
                Verification Code
            </label>
            <input formControlName="code" type="text" id="code"
                class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                [class.border-red-500]="codeForm.get('code')?.invalid && codeForm.get('code')?.touched" />
            <div *ngIf="codeForm.get('code')?.invalid && codeForm.get('code')?.touched" class="text-red-500 text-xs mt-1">
                Verification code is required
            </div>
        </div>

        <button type="submit" class="btn-main" [disabled]="codeForm.invalid || isLoading">
            <span *ngIf="!isLoading">Verify Code</span>
            <span *ngIf="isLoading">Verifying...</span>
        </button>
    </form>

    <!-- Step 3: Reset password -->
    <form [formGroup]="passwordForm" (ngSubmit)="onResetPassword()" *ngIf="step === 3">
        <div class="mb-4">
            <label for="newPassword" class="block mb-2 text-sm font-medium text-gray-900">
                New Password
            </label>
            <input formControlName="newPassword" type="password" id="newPassword"
                class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                [class.border-red-500]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" />
            <div *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" class="text-red-500 text-xs mt-1">
                <div *ngIf="passwordForm.get('newPassword')?.errors?.['required']">Password is required</div>
                <div *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">Password must be at least 8 characters</div>
                <div *ngIf="passwordForm.get('newPassword')?.errors?.['pattern']">
                    Password must contain at least one uppercase letter, one lowercase letter, one number, and one special character
                </div>
            </div>
        </div>

        <div class="mb-4">
            <label for="confirmPassword" class="block mb-2 text-sm font-medium text-gray-900">
                Confirm Password
            </label>
            <input formControlName="confirmPassword" type="password" id="confirmPassword"
                class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                [class.border-red-500]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched" />
            <div *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched" class="text-red-500 text-xs mt-1">
                <div *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">Please confirm your password</div>
                <div *ngIf="passwordForm.hasError('passwordMismatch')">Passwords do not match</div>
            </div>
        </div>

        <button type="submit" class="btn-main" [disabled]="passwordForm.invalid || isLoading">
            <span *ngIf="!isLoading">Reset Password</span>
            <span *ngIf="isLoading">Resetting...</span>
        </button>
    </form>

    <!-- Error message display -->
    <div *ngIf="errorMessage" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
        {{ errorMessage }}
    </div>

    <!-- Success message display -->
    <div *ngIf="successMessage" class="mt-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded">
        {{ successMessage }}
    </div>
</div>